<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Business Profile | Clay County Directory</title>
    <link rel="stylesheet" href="https://KFruti88.github.io/master.html/town-colors.css">
    <style>
        body { font-family: Arial, sans-serif; background-color: #d1d5db; display: flex; flex-direction: column; align-items: center; margin: 0; }
        
        .profile-container { 
            max-width: 800px; width: 90%; background-color: #fffaf0; 
            border: 2px solid #000; box-shadow: 10px 10px 5px rgba(0,0,0,0.2); 
            margin: 50px 0; padding: 40px; position: relative; overflow: hidden; 
        }

        /* PREMIUM STYLES */
        .premium-border { border: 4px solid #ffd700 !important; box-shadow: 0 0 20px rgba(255, 215, 0, 0.5) !important; }
        
        #gloss { 
            position: absolute; top: 0; left: -100%; width: 50%; height: 100%; 
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); 
            transform: skewX(-20deg); transition: none; pointer-events: none;
        }
        .gloss-animate { animation: shine 3s infinite; }
        @keyframes shine { 100% { left: 200%; } }

        .town-indicator { color: white; padding: 5px 15px; font-weight: bold; text-transform: uppercase; margin-top: 10px; display: inline-block; }
        #logo { max-width: 250px; margin-bottom: 20px; }
        .back-btn { display: inline-block; margin-top: 30px; padding: 10px 20px; background: #000; color: #fff; text-decoration: none; font-weight: bold; }
        
        .map-container { margin-top: 20px; border: 1px solid #000; height: 300px; width: 100%; background: #eee; }
        .hidden { display: none; }
        .upgrade-text { background: #fff3cd; padding: 15px; border: 1px solid #ffeeba; border-radius: 4px; margin-top: 20px; font-weight: bold; }
        .upgrade-text a { color: #856404; text-decoration: underline; }
    </style>
</head>
<body>

    <div class="profile-container" id="card-frame">
        <div id="gloss" class="hidden"></div>
        <img id="logo" src="" alt="Business Logo"><br>
        <h1 id="title"></h1>
        <div id="tag" class="town-indicator"></div>
        
        <p><strong>Phone:</strong> <span id="phone"></span></p>
        
        <div id="premium-info" class="hidden">
            <p><strong>Address:</strong> <span id="address"></span></p>
            <div class="map-container" id="map-box">
                <iframe id="map-frame" width="100%" height="100%" frameborder="0" style="border:0" allowfullscreen></iframe>
            </div>
        </div>

        <p id="bio"></p>
        
        <a href="index.html" class="back-btn">‚Üê BACK TO DIRECTORY</a>
    </div>

    <script>
        const id = new URLSearchParams(window.location.search).get('id');

        fetch('./directory.json')
            .then(res => res.json())
            .then(data => {
                const biz = data.find(b => b.id === id);
                if(biz) {
                    // Basic Information (Available to all)
                    document.getElementById('title').innerText = biz.name;
                    document.getElementById('phone').innerText = biz.phone || 'N/A';
                    document.getElementById('bio').innerText = biz.bio || 'Information coming soon.';
                    document.getElementById('logo').src = biz.logo;
                    document.getElementById('tag').innerText = biz.town;
                    document.getElementById('tag').className = `town-indicator ${biz.town.toLowerCase()}-bar`;

                    // Gatekeeper Logic for Premium Features
                    const cardFrame = document.getElementById('card-frame');
                    const premiumSection = document.getElementById('premium-info');
                    const glossEffect = document.getElementById('gloss');

                    if (biz.tier === "premium") {
                        // UNLOCK PREMIUM VISUALS
                        cardFrame.classList.add('premium-border'); 
                        glossEffect.classList.remove('hidden');    
                        glossEffect.classList.add('gloss-animate');
                        
                        // UNLOCK PREMIUM DATA
                        premiumSection.classList.remove('hidden'); 
                        document.getElementById('address').innerText = biz.address || 'Address not listed';
                        
                        // GENERATE MAP
                        if (biz.address) {
                            const mapUrl = `https://www.google.com/maps/embed/v1/place?key=YOUR_API_KEY_HERE&q=${encodeURIComponent(biz.address)}`;
                            // Note: For a quick free version without an API key, use this alternative:
                            const freeMap = `https://maps.google.com/maps?q=${encodeURIComponent(biz.address)}&t=&z=13&ie=UTF8&iwloc=&output=embed`;
                            document.getElementById('map-frame').src = freeMap;
                        }
                    } else {
                        // SHOW UPGRADE PROMPT FOR BASIC USERS
                        premiumSection.innerHTML = `
                            <div class="upgrade-text">
                                üìç Map and Address hidden. Own this business? 
                                <a href="mailto:your@email.com?subject=Upgrade%20Listing:%20${biz.name}">Upgrade to Premium</a> 
                                for glossy effects and a live map!
                            </div>`;
                        premiumSection.classList.remove('hidden');
                    }
                } else {
                    document.body.innerHTML = "<h1>Business Not Found</h1><a href='index.html'>Back</a>";
                }
            })
            .catch(err => console.error("Error loading directory:", err));
    </script>
</body>
</html>
